<div class="min-h-screen bg-[#f2f2f2]">
  <app-navbar></app-navbar>
  <div class="flex p-4">
    <!-- Main Content -->
    <div class="w-full items-center">
      <div class="border border-black p-4">
        <ng-container *ngFor="let criterion of criteria">
          <mat-card class="p-4 mb-4">
            <div class="flex items-center mb-4 justify-between">
              <h3 class="text-lg font-semibold">{{ criterion.name }}</h3>
              <div class="flex items-center">
                <h3 class="text-lg font-semibold">Evidence Reference Image</h3>
                <mat-icon class="cursor-pointer" matTooltip="This image will be used as a reference of the evidence for the dealership submitting an audit and the AI reviewing that audit.">help_outline</mat-icon>
              </div>
              <div class="flex items-center">
                <h3 class="text-lg font-semibold">Image Submission</h3>
                <mat-icon class="cursor-pointer" matTooltip="This image will be submitted with the audit for review.">help_outline</mat-icon>
              </div>
            </div>
            <div class="flex items-center justify-between">
              <markdown [data]="criterion.guidelines"></markdown>
              <img *ngIf="criterion.filename" [src]="'http://localhost:3000/posters/' + criterion.filename" alt="Criterion Image" class="w-32 h-auto object-contain mr-2 cursor-pointer" (click)="openModal('http://localhost:3000/posters/' + criterion.filename)">
            </div>
            /*<div>
              <input type="file" (change)="onFileSelected($event, criterion)" accept=".jpg, .jpeg, .png" [id]="'fileInput-' + criterion.criteriaID" style="display: none;" multiple>
              <div *ngIf="criterion.filename || selectedFiles[criterion.criteriaID]?.length">
                <img *ngFor="let selectedFileUrl of selectedFileUrls[criterion.criteriaID]" [src]="selectedFileUrl" alt="Selected Image" class="w-32 h-auto object-contain mr-2 cursor-pointer" (click)="openModal(selectedFileUrl)">
                <button
                class="absolute top-30 right-6 text-red-500 hover:text-red-700 bg-white border border-gray-300 rounded-full p-1 shadow-md active:bg-gray-200 active:border-gray-400"
                matTooltip="Delete"
                (click)="deleteImage(criterion)"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </div>
              <label *ngIf="!criterion.filename && !selectedFiles[criterion.criteriaID]?.length" [for]="'fileInput-' + criterion.criteriaID" class="cursor-pointer">
                <button mat-raised-button color="primary" class="mr-2 cursor-pointer" (click)="openFileInput(criterion)">Select Image</button>
              </label>
            </div>
          </mat-card>
        </ng-container>
      </div>
      <!-- Save All Button -->
      <div class="flex justify-end mt-4">
        <button mat-raised-button color="primary" (click)="submitAudit()">Submit</button>
      </div>
    </div>
  </div>

  <!-- Modal for Enlarged Image -->
  <ng-container *ngIf="modalImageUrl">
    <app-image-modal
      [imageUrl]="modalImageUrl"
      (close)="closeModal()"
    ></app-image-modal>
  </ng-container>
</div>
